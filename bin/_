#!/usr/bin/env python3
import os
import json
from threading import Thread

from bottle import Bottle, request, response, run

from _ import receive_messages

messages = {}
b = Bottle()

@b.get('/')
def root():
    response.set_header('Content-Language', 'en')
    response.set_header('Content-Type', 'application/json; charset=utf-8')
    response.status = 200
    return json.dumps(messages)

def main():
    host = os.environ['posse_host']
    username = os.environ['posse_email_address']
    password = os.environ['posse_password']
    args = host, username, password
    t = Thread(None, target = receive_messages,
               name = 'receive', args = (args, messages))
    t.start()
    run(b)

if __name__ == '__main__':
    main()
